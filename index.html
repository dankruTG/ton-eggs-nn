<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TON EGGS</title>
    <link rel="stylesheet" href="public\css\styles.css">
    <link rel="icon" href="public/images/TON-EGG.ico" type="image/x-icon">
    <script src="https://unpkg.com/@tonconnect/ui@0.0.9/dist/tonconnect-ui.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
   
   
</head>
<body>
    <div id="root"></div>
    
    <script type="module" src="./js/firebase.js"></script>
    <script src="public/js/inventory.js"></script>
    <script src="public/js/eggsData.js"></script>
    <script type="module" src="public/js/addEggs.js"></script>
    <script type="module" src="public/js/openShop.js"></script>
    <script type="module" src="public/js/energy.js"></script>
    <script type="module" src="public/js/rewards.js"></script>
    <script src ="public/js/menu.js"></script>
    <script type="module" src="public/js/profile.js"></script>

    
    <div id="eggDiggModal" class="modal">
        <div class="modal-content">
            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–±—ã—á–∏ -->
        </div>
    </div>
    
    <div id="walletContainer"></div>
    <script type="module">
        import { saveProgress, getProgress } from 'public/js/firebase.js';

        Telegram.WebApp.ready();

        const user = Telegram.WebApp.initDataUnsafe.user;
        const userId = user.id;
        const username = tg.initDataUnsafe.user.username;
        console.log(`User ID: ${userId}, Username: ${username}`);

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        getProgress(userId).then(savedProgress => {
            if (savedProgress) {
                console.log('Restored progress:', savedProgress);
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            }
            else {
                saveProgress(userId, { userId, username: username });
                console.log('New user!')};
        });
    </script>
    <script type="module">
        import { handleWalletConnection } from './public/js/rewards.js';
    
        Telegram.WebApp.ready();
    
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://dankrutg.github.io/ton-eggs-nn/tonconnect-manifest.json',
            buttonRootId: 'walletContainer'
        });
    
        async function handleConnectionStatus(wallet) {
            console.log('Wallet status changed:', wallet);
            if (wallet) {
                const userId = Telegram.WebApp.initDataUnsafe.user.id;
                const walletAddress = wallet.account.address;
                console.log('User ID:', userId);
                console.log('Wallet Address:', walletAddress);
                try {
                    await handleWalletConnection(userId, walletAddress);
                    console.log('Wallet address sent for saving:', walletAddress);
                } catch (error) {
                    console.error('Error handling wallet connection:', error);
                }
            } else {
                console.log('No wallet connected');
            }
        }
    
        tonConnectUI.onStatusChange(handleConnectionStatus);
    </script>
    
    <div id="notComplete" class="not-complete-modal">
        <div class="modal-content">
            <span class="close" onclick="closeNotCompleteModal()">&times;</span>
            <p>–ó–∞–¥–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
        </div>
    </div>
    <div id="loadingOverlay" class="loading-overlay">
        <div id="loadingIndicator" class="loading-indicator">
            <div class="spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>
    </div>

    <div id="energyContainer">
        <div id="energyContent">
            <img id="energyIcon" src="public/images/energy.png" alt="Energy Icon">
            <span id="energyText">Text</span>
        </div>
        <div id="energyBarContainer">
            <div id="energyBar"></div>
        </div>
    </div>
    <div id="coinModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–í–∞—à –¥—Ä–æ–ø</h2>
            <div id="coinInfo">
                <img id="coinImage" src="public/images/coin.png" alt="–ú–æ–Ω–µ—Ç–∞ eShells">
                <span id="droppedCoinsCount"></span>
            </div>
            <div id="dropEggInfo">
                <img id="eggImageInDrop" src="" alt="–í—ã–ø–∞–≤—à–µ–µ —è–π—Ü–æ">
                <span id="eggNameInDrop"></span>
            </div>
        </div>
    </div>
    <div id="clickCounter">–ù–∞—á–Ω–∏ –¥–æ–±—ã–≤–∞—Ç—å –ª—é–±–æ–µ —è–π—Ü–æ</div>
    <div id="coinBalanceContainer">
        <div id="coinBalance">0</div>
        <img id="coinImage" src="public/images/coin.png" alt="Coin Image">
    </div>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–∫–æ–Ω–∫–∞–º–∏ –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div id="bottomIconsContainer">
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–µ—Ä–≤–æ–π –∏–∫–æ–Ω–∫–∏ -->
        <div class="iconContainer" onclick="openInventory()">
            <img src="public/images/inventory_icon.png" alt="Inventory Icon">
        </div>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Ç–æ—Ä–æ–π –∏–∫–æ–Ω–∫–∏ -->
        <div class="iconContainer" onclick="openShopModal()">
            <img src="public/images/shop_icon.png" alt="Shop Icon">
        </div>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç—Ä–µ—Ç—å–µ–π –∏–∫–æ–Ω–∫–∏ -->
        <div class="iconContainer" onclick="openRewardsModal()">
            <img src="public/images/rewards_icon.png" alt="Rewards Icon">
        </div>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —á–µ—Ç–≤–µ—Ä—Ç–æ–π –∏–∫–æ–Ω–∫–∏ -->
        <div class="iconContainer">
            <img id="menuButton" src="public/images/invite_icon.png" alt="Invite Icon">
            <div id="menu" class="menu">
                <button id="profileButton">PROFILE</button>
                <button id="leaderboardButton">LEADERBOARD</button>
                <button id="frensButton">FRENS</button>
            </div>
        </div>
    </div>
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <div id="profileContent"></div>
        </div>
    </div>
    
    <div id="usernameModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUsernameModal()">&times;</span>
            <h2>–í–≤–µ–¥–∏—Ç–µ –∏–º—è</h2>
            <input type="text" id="usernameInput" placeholder="–ò–º—è (5-15 —Å–∏–º–≤–æ–ª–æ–≤)">
            <button onclick="saveUsername()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalMessage"></div>
        </div>
    </div>
    
    <div id="inventoryModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
            <div id="inventoryItemsContainer"></div> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —è–∏—Ü –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ -->
        </div>
    </div>
        <!-- HTML-—Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —è–π—Ü–µ -->
    <div id="eggInfoModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Description</h2>
            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —è–π—Ü–µ -->
        </div>
    </div>
    
    
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞–≥–∞–∑–∏–Ω–∞ -->
        <div id="shopModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
                <div id="shopItems">
                    <div class="shopItem" id="buyCommonEgg">
                        <button class="common-egg-button" onclick="buyEgg('Common', 50)">Buy Common Egg - 50 $Shells</button>
                    </div>
                    <div class="shopItem" id="buyUncommonEgg">
                        <button class="uncommon-egg-button" onclick="buyEgg('Uncommon', 500)">Buy Uncommon Egg - 500 $Shells</button>
                    </div>
                    <div class="shopItem" id="buyRareEgg">
                        <button class="rare-egg-button" onclick="buyEgg('Rare', 1000)">–ö—É–ø–∏—Ç—å —Ä–µ–¥–∫–æ–µ —è–π—Ü–æ - 1000 $Shells</button>
                    </div>
                    <div class="shopItem" id="buySecretEgg">
                        <button class="secret-egg-button" onclick="buyEgg('Secret', 2500)">–ö—É–ø–∏—Ç—å —Ä–µ–¥–∫–æ–µ —è–π—Ü–æ - 2500 $Shells</button>
                    </div>
                    <div class="shopItem" id="buyMyficalEgg">
                        <button class="myfical-egg-button" onclick="buyEgg('Myfical', 10000)">–ö—É–ø–∏—Ç—å –ú–ò–§–ò–ß–ï–°–ö–û–ï —è–π—Ü–æ - 10000 $Shells</button>
                    </div>
                    <div class="shopItem" id="buySpeedUpgrade">
                        <button class="upgrade-speed-button" onclick="buyUpgrade('speed')">Damage ‚õèUP‚õè (Cost: <span id="speedUpgradePrice">100</span> $Shells) <span id="speedUpgradeLevel">Lvl 1</span></button>
                    </div>
                    <div class="shopItem" id="buyEnergyUpgrade">
                        <button class="upgrade-energy-button" onclick="buyUpgrade('energy')">Energy limit üîãUPüîã (Cost: <span id="energyUpgradePrice">50</span> $Shells) <span id="energyUpgradeLevel">Lvl 1</span></button>
                    </div>
                </div>
            </div>
        </div>

</body>
</html>
